---
######## MySQL #########
mysql_root_password: "{{ db_root_pass }}"
mysql_databases:
  - name: streama
    encoding: utf8
    collation: utf8_general_ci
mysql_users:
  - name: streama
    host: "%"
    password: "{{ db_user_pass }}"
    priv: "streama.*:ALL"
mysql_bind_address: '127.0.0.1'
mysql_packages:
  - mariadb-client
  - mariadb-server
  - mariadb-common
mysql_datadir: /var/lib/mysql

########## nginx reverse proxy #######
nginx_revproxy_sites:      
  ##############################################################
  ###!!!!!EDIT DOMAIN HERE AND IN INSTANCES.TF (TERRAFORM)!!!###
  ##############################################################                                   
  fireflix.stream:                                                    
    domains:                                                  
      - fireflix.stream
      - www.fireflix.stream
    upstreams:                                                
      - { backend_address: 127.0.0.1, backend_port: 8080 }
    ssl: true                                                 
    letsencrypt: true
    letsencrypt_email: "none@none.com"  
  app.fireflix.stream:                                                
    domains:                                                  
      - app.fireflix.stream
      - www.app.fireflix.stream
    upstreams:                                                
      - { backend_address: 127.0.0.1, backend_port: 8081 }
    ssl: true                                                 
    letsencrypt: true
    letsencrypt_email: "none@none.com"                        
nginx_revproxy_certbot_auto: true
nginx_revproxy_certbot_packages:
  - certbot
  - python3-certbot-nginx

########## automysqlbackup ###########
backup_database_script: |
  #!/bin/bash
  /usr/bin/mysqldump --all-databases --single-transaction --skip-lock-tables --add-drop-database > /opt/dbbackup/backup.sql
  #you can add a upload script here, I use backblaze b2
  /usr/local/bin/b2 authorize-account {{ b2AppKeyIdBackup }} {{ b2AppKeyBackup }}
  /usr/local/bin/b2 sync /opt/dbbackup b2://dbbucket
  /usr/local/bin/b2 upload-file dbbucket /var/log/cloud-init-output.log cloud-init-output.log